(()=>{"use strict";function t(t){return t*Math.PI/180}var e={SCREEN_WIDTH:window.innerWidth,SCREEN_HEIGHT:window.innerHeight,TICK:30,CELL_SIZE:32,FOV:t(60),COLORS:{floor:"#d52b1e",ceiling:"#ffffff",wall:"#013aa6",wallDark:"#012975",rays:"#ffa600"}};console.log(e);var n={x:1.5*e.CELL_SIZE,y:2*e.CELL_SIZE,width:e.CELL_SIZE/2,height:e.CELL_SIZE/2,angle:t(0),speed:0},r=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1],[1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,0,1],[1,0,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,0,1],[1,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,1],[1,1,1,1,1,0,0,1,1,1,1,0,0,1,1,0,0,1,1,1,1,0,0,1,1,1,1,1],[1,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,1],[1,0,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,0,1],[1,0,1,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,0,1,1,0,1,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1],[1,0,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],a=document.createElement("canvas");a.setAttribute("width",e.SCREEN_WIDTH),a.setAttribute("height",e.SCREEN_HEIGHT),document.body.appendChild(a);var o=a.getContext("2d");function i(t,e,n,r){return Math.sqrt(Math.pow(n-t,2)+Math.pow(r-e,2))}function l(t,e){return t<0||t>=r[0].length||e<0||e>=r.length}function E(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var f=.1*e.CELL_SIZE;function c(t,e,r){var a,o=function(t,e,r){return[{x:t-n.width/2-r,y:e-n.height/2-r},{x:t+n.width/2+r,y:e-n.height/2-r},{x:t-n.width/2-r,y:e+n.height/2+r},{x:t+n.width/2+r,y:e+n.height/2+r}]}(t,e,r),i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return E(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){l=!0,o=t},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw o}}}}(o);try{for(i.s();!(a=i.n()).done;){var l=a.value;if(h(l.x,l.y))return!0}}catch(t){i.e(t)}finally{i.f()}return!1}function h(t,n){var a=Math.floor(t/e.CELL_SIZE),o=Math.floor(n/e.CELL_SIZE);return r[o]&&1===r[o][a]}setInterval((function(){var t,a,E;o.fillStyle="red",o.fillRect(0,0,e.SCREEN_WIDTH,e.SCREEN_HEIGHT),t=n.speed,a=n.x+Math.cos(n.angle)*t,E=n.y+Math.sin(n.angle)*t,c(a,n.y,f)||(n.x=a),c(n.x,E,f)||(n.y=E);var h,u,L,S=(h=n.angle-e.FOV/2,u=e.SCREEN_WIDTH,L=e.FOV/u,Array.from({length:u},(function(t,a){return E=function(t){for(var a,o=Math.abs(Math.floor((t-Math.PI/2)/Math.PI)%2),E=o?Math.floor(n.x/e.CELL_SIZE)*e.CELL_SIZE+e.CELL_SIZE:Math.floor(n.x/e.CELL_SIZE)*e.CELL_SIZE,f=n.y+(E-n.x)*Math.tan(t),c=o?e.CELL_SIZE:-e.CELL_SIZE,h=c*Math.tan(t),u=E,L=f;!a;){var S=o?Math.floor(u/e.CELL_SIZE):Math.floor(u/e.CELL_SIZE)-1,y=Math.floor(L/e.CELL_SIZE);if(l(S,y))break;(a=r[y][S])||(u+=c,L+=h)}return{angle:t,distance:i(n.x,n.y,u,L),vertical:!0}}(o=h+a*L),f=function(t){for(var a,o=Math.abs(Math.floor(t/Math.PI)%2),E=o?Math.floor(n.y/e.CELL_SIZE)*e.CELL_SIZE:Math.floor(n.y/e.CELL_SIZE)*e.CELL_SIZE+e.CELL_SIZE,f=n.x+(E-n.y)/Math.tan(t),c=o?-e.CELL_SIZE:e.CELL_SIZE,h=c/Math.tan(t),u=f,L=E;!a;){var S=Math.floor(u/e.CELL_SIZE),y=o?Math.floor(L/e.CELL_SIZE)-1:Math.floor(L/e.CELL_SIZE);if(l(S,y))break;(a=r[y][S])||(u+=h,L+=c)}return{angle:t,distance:i(n.x,n.y,u,L),vertical:!1}}(o),f.distance>=E.distance?E:f;var o,E,f})));(function(t){t.forEach((function(t,r){var a=function(t,e,n){var r=e-n;return t*Math.cos(r)}(t.distance,t.angle,n.angle),i=5*e.CELL_SIZE/a*277;o.fillStyle=t.vertical?e.COLORS.wallDark:e.COLORS.wall,o.fillRect(r,e.SCREEN_HEIGHT/2-i/2,1,i),o.fillStyle=e.COLORS.floor,o.fillRect(r,e.SCREEN_HEIGHT/2+i/2,1,e.SCREEN_HEIGHT/2-i/2),o.fillStyle=e.COLORS.ceiling,o.fillRect(r,0,1,e.SCREEN_HEIGHT/2-i/2)}))})(S),function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,l=arguments.length>3?arguments[3]:void 0,E=i*e.CELL_SIZE;r.forEach((function(e,n){e.forEach((function(e,r){e&&(o.fillStyle="grey",o.fillRect(t+r*E,a+n*E,E,E))}))})),o.fillStyle="blue",o.fillRect(t+n.x*i-5,a+n.y*i-5,10,10),o.strokeStyle="blue",o.beginPath(),o.moveTo(n.x*i,n.y*i),o.lineTo((n.x+20*Math.cos(n.angle))*i,(n.y+20*Math.sin(n.angle))*i),o.closePath(),o.stroke(),o.strokeStyle=e.COLORS.rays,l.forEach((function(t){o.beginPath(),o.moveTo(n.x*i,n.y*i),o.lineTo((n.x+Math.cos(t.angle)*t.distance)*i,(n.y+Math.sin(t.angle)*t.distance)*i),o.closePath(),o.stroke()}))}(0,0,.25,S)}),e.TICK),a.addEventListener("click",(function(){})),document.addEventListener("keydown",(function(e){"w"===e.key&&(n.speed=1),"s"===e.key&&(n.speed=-1),"a"===e.key&&(n.angle-=t(5)),"d"===e.key&&(n.angle+=t(5))})),document.addEventListener("mousemove",(function(t){})),document.addEventListener("keyup",(function(t){"w"!==t.key&&"s"!==t.key||(n.speed=0)}))})();