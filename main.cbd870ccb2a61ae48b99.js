(()=>{var t=[[1,1,1,1,1,1,1],[1,0,0,0,0,0,1],[1,0,1,1,0,1,1],[1,0,0,0,0,0,1],[1,0,1,0,1,0,1],[1,0,1,0,1,0,1],[1,1,1,1,1,1,1]],e=window.innerWidth,a=window.innerHeight,n=32,o=.75,l=y(60),r="#d52b1e",i="#ffffff",f="#013aa6",h="#012975",c="#ffa600",s={x:48,y:64,angle:y(0),speed:0},d=document.createElement("canvas");d.setAttribute("width",e),d.setAttribute("height",a),document.body.appendChild(d);var M=d.getContext("2d");function y(t){return t*Math.PI/180}function u(t,e,a,n){return Math.sqrt(Math.pow(a-t,2)+Math.pow(n-e,2))}function g(e,a){return e<0||e>=t[0].length||a<0||a>=t.length}setInterval((function(){M.fillStyle="red",M.fillRect(0,0,e,a),function(){var e,a;if(s.x+=Math.cos(s.angle)*s.speed,s.y+=Math.sin(s.angle)*s.speed,e=Math.floor(s.x/n),a=Math.floor(s.y/n),1===t[a][e])return s.x-=Math.cos(s.angle)*s.speed,void(s.y-=Math.sin(s.angle)*s.speed);s.x+=Math.cos(s.angle)*s.speed,s.y+=Math.sin(s.angle)*s.speed}();var d,y,v,x=(d=s.angle-l/2,v=l/(y=e),Array.from({length:y},(function(e,a){return l=function(e){for(var a,o=Math.abs(Math.floor((e-Math.PI/2)/Math.PI)%2),l=o?Math.floor(s.x/n)*n+n:Math.floor(s.x/n)*n,r=s.y+(l-s.x)*Math.tan(e),i=o?n:-32,f=i*Math.tan(e),h=l,c=r;!a;){var d=o?Math.floor(h/n):Math.floor(h/n)-1,M=Math.floor(c/n);if(g(d,M))break;(a=t[M][d])||(h+=i,c+=f)}return{angle:e,distance:u(s.x,s.y,h,c),vertical:!0}}(o=d+a*v),r=function(e){for(var a,o=Math.abs(Math.floor(e/Math.PI)%2),l=o?Math.floor(s.y/n)*n:Math.floor(s.y/n)*n+n,r=s.x+(l-s.y)/Math.tan(e),i=o?-32:n,f=i/Math.tan(e),h=r,c=l;!a;){var d=Math.floor(h/n),M=o?Math.floor(c/n)-1:Math.floor(c/n);if(g(d,M))break;(a=t[M][d])||(h+=f,c+=i)}return{angle:e,distance:u(s.x,s.y,h,c),vertical:!1}}(o),r.distance>=l.distance?l:r;var o,l,r})));(function(t){t.forEach((function(t,e){var n=160/function(t,e,a){var n=e-a;return t*Math.cos(n)}(t.distance,t.angle,s.angle)*277;M.fillStyle=t.vertical?h:f,M.fillRect(e,a/2-n/2,1,n),M.fillStyle=r,M.fillRect(e,a/2+n/2,1,a/2-n/2),M.fillStyle=i,M.fillRect(e,0,1,a/2-n/2)}))})(x),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;t.forEach((function(t,n){t.forEach((function(t,o){t&&(M.fillStyle="grey",M.fillRect(e+24*o,a+24*n,24,24))}))})),M.fillStyle="blue",M.fillRect(e+s.x*o-5,a+s.y*o-5,10,10),M.strokeStyle="blue",M.beginPath(),M.moveTo(s.x*o,s.y*o),M.lineTo((s.x+20*Math.cos(s.angle))*o,(s.y+20*Math.sin(s.angle))*o),M.closePath(),M.stroke(),M.strokeStyle=c,n.forEach((function(t){M.beginPath(),M.moveTo(s.x*o,s.y*o),M.lineTo((s.x+Math.cos(t.angle)*t.distance)*o,(s.y+Math.sin(t.angle)*t.distance)*o),M.closePath(),M.stroke()}))}(0,0,x)}),30),document.addEventListener("keydown",(function(t){"w"===t.key&&(s.speed=2),"s"===t.key&&(s.speed=-2),"a"===t.key&&(s.angle-=y(5)),"d"===t.key&&(s.angle+=y(5))})),document.addEventListener("keyup",(function(t){"w"!==t.key&&"s"!==t.key||(s.speed=0)}))})();